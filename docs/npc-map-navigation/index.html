<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="LG Silicon Valley Lab">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>NPC Map Navigation - LGSVL Simulator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "NPC Map Navigation";
    var mkdocs_page_input_path = "npc-map-navigation.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-130546445-1', 'lgsvlsimulator.com/docs');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LGSVL Simulator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Quick start</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting-started/">Getting started</a>
                </li>
                <li class="">
                    
    <a class="" href="../build-instructions/">Build instructions</a>
                </li>
                <li class="">
                    
    <a class="" href="../keyboard-shortcuts/">Keyboard shortcuts</a>
                </li>
                <li class="">
                    
    <a class="" href="../perception-ground-truth/">Ground truth obstacles</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Integration with AD</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../autoware-instructions/">Running with Autoware</a>
                </li>
                <li class="">
                    
    <a class="" href="../apollo3-5-instructions/">Running with Apollo 3.5</a>
                </li>
                <li class="">
                    
    <a class="" href="../apollo-instructions/">Running with Apollo 3.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../python-api/">Python API</a>
                </li>
                <li class="">
                    
    <a class="" href="../api-quickstart-descriptions/">Python API Examples</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../map-annotation/">Map Annotation</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">NPC Map Navigation</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#npc-map-navigation">NPC Map Navigation</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#map-manager">Map Manager</a></li>
        
            <li><a class="toctree-l4" href="#map-lane-and-intersection-grouping">Map Lane and Intersection Grouping</a></li>
        
            <li><a class="toctree-l4" href="#map-intersection-builder">Map Intersection Builder</a></li>
        
            <li><a class="toctree-l4" href="#traffic-lights">Traffic Lights</a></li>
        
            <li><a class="toctree-l4" href="#stopline-and-maplanesegmentbuilder-overlap">StopLine and MapLaneSegmentBuilder overlap</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../create-ros2-ad-stack/">How to create a simple ROS2-based AD stack</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LGSVL Simulator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>NPC Map Navigation</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/lgsvl/simulator/edit/master/docs/npc-map-navigation.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="npc-map-navigation">NPC Map Navigation</h1>
<p><a href="../images/full_size_images/NPCSetup.jpg"><img alt="NPCSetup" src="../images/NPCSetup.jpg" /></a></p>
<p>Non-player character (NPC) vehicles now use the MapSegmentBuilder classes to navigate annotated maps.</p>
<h5 id="map-manager">Map Manager</h5>
<p><a href="../images/full_size_images/NPCSetup_MapManager.jpg"><img alt="" src="../images/NPCSetup_MapManager.jpg" /></a></p>
<p>Use SanFrancisco.scene as a template to build map data for NPCs.</p>
<ol>
<li>Remove <span style='color:blue'>SFTraffic_New.prefab</span> from scene and any associated scripts, e.g., TrafPerformanceManager.cs, TrafInfoManager.cs and TrafSystem.cs.</li>
<li>Create a new GameObject at position Vector3.zero and Quaternion.identity, named <span style='color:blue'>Map</span>.</li>
<li>Add MapManager.cs component to this object and save as a <span style='color:blue'>prefab</span> in project assets.</li>
<li>The public field, SpawnLanesHolder, of MapManager.cs requires the <span style='color:blue'>MapLaneSegmentBuilder</span> holder transform.</li>
<li>The public field, IntersectionsHolder, of MapManager.cs requires the <span style='color:blue'>TrafficLights</span> holder transform.  This has intersection meshes and scripts for lights.</li>
<li>The public fields Green, Yellow, and Red are materials for the segmentation camera system.  If using the Traffic meshes from SanFrancisco.scene, these need to be added here.  If not, IntersectionComponent.cs and associated scripts will need to be edited.</li>
</ol>
<h5 id="map-lane-and-intersection-grouping">Map Lane and Intersection Grouping</h5>
<p><a href="../images/full_size_images/NPCSetup_MapBuilderIntersectionGroup.jpg"><img alt="NPCSetup_IntersectionMapBuilder" src="../images/NPCSetup_MapBuilderIntersectionGroup.jpg" /></a></p>
<ol>
<li>Create <span style='color:blue'>TrafficLanes</span> holder object as a child of <span style='color:blue'>Map.prefab</span>.</li>
<li>Place all <span style='color:blue'>MapLaneSegmentBuilder</span> objects into <span style='color:blue'>TrafficLanes</span> holder object for all non intersection lanes.</li>
<li>Create <span style='color:blue'>IntersectionLanes</span> holder object as a child of <span style='color:blue'>Map.prefab</span>.</li>
<li>Create a new <span style='color:blue'>Intersection</span> holder object as a child of <span style='color:blue'>IntersectionLanes</span> transform for each intersection annotation.  <strong>Be sure its world position is in the center of each intersection.</strong></li>
<li>Place <span style='color:blue'>MapLaneSegmentBuilder</span> and <span style='color:blue'>MapStopLineSegmentBuilder</span> objects into <span style='color:blue'>Intersection</span> holder object for each intersection.</li>
</ol>
<h5 id="map-intersection-builder">Map Intersection Builder</h5>
<p><a href="../images/full_size_images/NPCSetup_IntersectionMapBuilder.jpg"><img alt="NPCSetup_IntersectionMapBuilder" src="../images/NPCSetup_IntersectionMapBuilder.jpg" /></a></p>
<ol>
<li>For each <span style='color:blue'>Intersection</span> holder, add the MapIntersectionBuilder.cs component.</li>
</ol>
<h5 id="traffic-lights">Traffic Lights</h5>
<p><a href="../images/full_size_images/NPCSetup_TrafficLight01.jpg"><img alt="NPCSetup_TrafficLight01" src="../images/NPCSetup_TrafficLight01.jpg" /></a></p>
<ol>
<li>Create a <span style='color:blue'>TrafficLights</span> holder object to hold all traffic light meshes or place all traffic meshes under the map annotation <span style='color:blue'>Intersections</span>.  Just be sure to have the root holder be in MapManager.cs IntersectionHolder public reference.</li>
<li>Create a <span style='color:blue'>Intersection</span> holder object.  <strong>Be sure its world position is in the center of each intersection.</strong></li>
<li>Add IntersectionComponent.cs to each <span style='color:blue'>Intersection</span> holder object.</li>
</ol>
<p><a href="../images/full_size_images/NPCSetup_TrafficLight02.jpg"><img alt="NPCSetup_TrafficLight02" src="../images/NPCSetup_TrafficLight02.jpg" /></a></p>
<ol>
<li>Place <span style='color:blue'>TrafficLightPole</span> facing it's corresponding <span style='color:blue'>StopLineSegmentBuilder</span> object.  <strong>The transfom needs to be Z axis or gizmo arrow forward, parallel to the StopLineSegmentBuilder object Z axis or gizmo arrow forward.</strong></li>
<li>Add IntersectionTrafficLightSetComponent.cs.</li>
<li>Place as a child of the <span style='color:blue'>Intersection</span> holder object.</li>
<li>For opposite facing <span style='color:blue'>TrafficLightPoles</span> and <span style='color:blue'>StopLineSegmentBuilders</span>, <strong>be sure to orient transforms in Z axis or gizmo arrow forward but perpendicular to other facing light poles and stoplines.</strong>  </li>
</ol>
<p><a href="../images/full_size_images/NPCSetup_TrafficLight03.jpg"><img alt="NPCSetup_TrafficLight03" src="../images/NPCSetup_TrafficLight03.jpg" /></a></p>
<ol>
<li>Add <span style='color:blue'>TrafficLight</span> meshes as children of the <span style='color:blue'>TrafficLightPole</span>.</li>
<li>Add IntersectionTrafficLightSetComponent.cs to each <span style='color:blue'>TrafficLight</span>.</li>
</ol>
<h5 id="stopline-and-maplanesegmentbuilder-overlap">StopLine and MapLaneSegmentBuilder overlap</h5>
<p><a href="../images/full_size_images/NPCSetup_StopLineAndLaneOverlap.jpg"><img alt="NPCSetup_StopLineAndLaneOverlap" src="../images/NPCSetup_StopLineAndLaneOverlap.jpg" /></a></p>
<p><strong>MapLaneSegmentBuilders final waypoint needs to be slightly overlapping the MapStopLineBuilder</strong></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../create-ros2-ad-stack/" class="btn btn-neutral float-right" title="How to create a simple ROS2-based AD stack">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../map-annotation/" class="btn btn-neutral" title="Map Annotation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2019 LG Electronics Inc.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/lgsvl/simulator/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../map-annotation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../create-ros2-ad-stack/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
