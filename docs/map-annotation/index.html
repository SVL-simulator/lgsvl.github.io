<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="LG Silicon Valley Lab">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Map Annotation - LGSVL Simulator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Map Annotation";
    var mkdocs_page_input_path = "map-annotation.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-130546445-1', 'lgsvlsimulator.com/docs');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LGSVL Simulator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Quick start</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting-started/">Getting started</a>
                </li>
                <li class="">
                    
    <a class="" href="../build-instructions/">Build instructions</a>
                </li>
                <li class="">
                    
    <a class="" href="../keyboard-shortcuts/">Keyboard shortcuts</a>
                </li>
                <li class="">
                    
    <a class="" href="../perception-ground-truth/">Ground truth obstacles</a>
                </li>
                <li class="">
                    
    <a class="" href="../faq/">Frequently asked questions</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Integration with AD</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../autoware-instructions/">Running with Autoware</a>
                </li>
                <li class="">
                    
    <a class="" href="../apollo3-5-instructions/">Running with Apollo 3.5</a>
                </li>
                <li class="">
                    
    <a class="" href="../apollo-instructions/">Running with Apollo 3.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../python-api/">Python API</a>
                </li>
                <li class="">
                    
    <a class="" href="../api-quickstart-descriptions/">Python API Examples</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Map Annotation</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#map-annotation">Map Annotation</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#creating-a-new-map">Creating a new map</a></li>
        
            <li><a class="toctree-l4" href="#annotate-lanes">Annotate Lanes</a></li>
        
            <li><a class="toctree-l4" href="#traffic-light-annotation">Traffic light annotation</a></li>
        
            <li><a class="toctree-l4" href="#create-traffic-pole-and-link-to-contained-signal-light-additional-step-for-autoware">Create traffic pole and link to contained signal light (additional step for Autoware)</a></li>
        
            <li><a class="toctree-l4" href="#export-map-files">Export map files</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../npc-map-navigation/">NPC Map Navigation</a>
                </li>
                <li class="">
                    
    <a class="" href="../add-new-ego-vehicle/">How to add a new ego vehicle</a>
                </li>
                <li class="">
                    
    <a class="" href="../create-ros2-ad-stack/">How to create a simple ROS2-based AD stack</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LGSVL Simulator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>Map Annotation</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/lgsvl/simulator/edit/master/docs/map-annotation.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="map-annotation">Map Annotation</h1>
<p>The LGSVL Simulator supports creating, editing, and exporting of HD/vector maps of existing 3D environments (Unity scenes). The maps can be saved in the currently supported Apollo or Autoware formats.</p>
<p>Currently, map annotation is only supported while running the simulator as a Unity project in a Windows environment.</p>
<h2 id="creating-a-new-map">Creating a new map</h2>
<ul>
<li>Open <code>MapToolUtilEdit</code> in <code>Unity</code>: <code>Window</code> -&gt; <code>Map Tool Panel</code></li>
</ul>
<p><a href="../images/full_size_images/annotation-window-menu.png"><img alt="" src="../images/annotation-window-menu.jpg" /></a></p>
<ul>
<li>By default, map annotation is not shown. Click <code>Show/Hide Map</code> to show existing map annotation.</li>
<li>Before annotation, select correct <code>Parent Object</code> in MapToolUtilEdit, for example <code>Map</code>. Then every new object you create will be under <code>Map</code> object. </li>
</ul>
<p><a href="../images/annotation-mapToolPanel.jpg"><img alt="" src="../images/annotation-mapToolPanel.jpg" /></a>
- After annotation is done, remember to save: go to <code>Map</code> level, click <code>Apply</code> </p>
<h2 id="annotate-lanes">Annotate Lanes</h2>
<h4 id="create-temp-map-waypoint">Create temp map waypoint</h4>
<ul>
<li>Maker sure your roads belong to the layer of <code>Ground and Road</code> since waypoint will be only created on this layer.</li>
<li>Click <code>Create Temp Map Waypoint</code> button to create a new point in the center of current scene window.</li>
</ul>
<p><a href="../images/full_size_images/annotation-tempWayPoint.PNG"><img alt="tempMapWayPoint" src="../images/annotation-tempWayPoint.jpg" /></a></p>
<h4 id="make-lane">Make Lane</h4>
<ul>
<li>Select the waypoint, <code>ctrl</code> + <code>d</code> to duplicate and move them to desired positions</li>
</ul>
<p><a href="../images/full_size_images/annotation-threeWayPoints.PNG"><img alt="" src="../images/annotation-threeWayPoints.jpg" /></a>
- Connect them to make a lane
  - Sequentially select points
  - Click <code>Make Lane (MapLaneSegmentBuilder)</code> button to make a lane</p>
<p><a href="../images/full_size_images/annotation-makeLane.PNG"><img alt="" src="../images/annotation-makeLane.jpg" /></a>
- You can make <code>StopLine</code> and <code>BoundaryLine</code> in a similar way by using the other two buttons below <code>Make Lane (MapLaneSegmentBuilder)</code></p>
<p><a href="../images/full_size_images/annotation-stopLine+boundaryLine.PNG"><img alt="" src="../images/annotation-stopLine+boundaryLine.jpg" /></a></p>
<ul>
<li>In-Between Lane Generation</li>
<li>You can make lanes by creating temp points and connecting them, and you can also make an in-between lane easily when you have two existing lanes and want to make another lane to connect them together</li>
<li>Select both lanes, create the new in-between lane by clicking <code>Auto Generate In-Between Lane</code> button at the bottom of MapToolUtilEdit panel</li>
</ul>
<p><a href="../images/full_size_images/annotation-makeInBetweenLane.PNG"><img alt="" src="../images/annotation-makeInBetweenLane.jpg" /></a></p>
<ul>
<li>Because you might want to connect lanes of different angles and do it multiple times, we provide the ability of saving different presets to generate in-between lanes. <ul>
<li>Larger value of <code>Tangent</code> makes the lane more straight</li>
<li>You can also change the number of presets by changing <code>Preset Count</code></li>
<li>Check <code>Offset Start/End Points</code> if you want a small offset between the end points of the new lane and the end point of the selected two lanes, otherwise those points will overlap with each other completely.</li>
</ul>
</li>
</ul>
<h4 id="link-neighbor-lanes">Link neighbor lanes</h4>
<ul>
<li>After you create parallel lanes, you need to link them to have correct relations </li>
<li>Link neighbor lanes of same direction<ul>
<li>Select lanes sequentially from left/right</li>
<li>Click <code>Link Neighbor Lanes from Left/Right</code> to link them</li>
<li>After linking, you can check it in every lane object's inspector</li>
</ul>
</li>
</ul>
<p><a href="../images/full_size_images/annotation-neighborLaneLink.PNG"><img alt="" src="../images/annotation-neighborLaneLink.jpg" /></a></p>
<ul>
<li>Link reverse neighbor lanes<ul>
<li>Select both reverse neighbor lanes</li>
<li>Click <code>Link Reverse Neighbor Lanes</code></li>
</ul>
</li>
</ul>
<p><a href="../images/full_size_images/annotation-reverseNeighborLaneLink.PNG"><img alt="" src="../images/annotation-reverseNeighborLaneLink.jpg" /></a></p>
<ul>
<li>
<p>In the above screenshot, double yellow boundary lane can be generated by creating BoundaryLine and changing its <code>Line Type</code> from <code>SOLID_WHITE</code> to <code>DOUBLE_YELLOW</code> in its inspector</p>
</li>
<li>
<p>If anything goes wrong, you can nullify all neighbor lane fields by clicking <code>Nullify All Neighbor Lane Fields</code> button</p>
</li>
</ul>
<h4 id="set-correct-leftright-boundary-type">Set correct left/right boundary type</h4>
<ul>
<li>The rightmost lane typically has a right boundary type of <code>CURB</code></li>
</ul>
<p><a href="../images/full_size_images/annotation-boundary-CURB.PNG"><img alt="" src="../images/annotation-boundary-CURB.jpg" /></a></p>
<ul>
<li>Middle lanes typically have a left boundary type of <code>DOUBLE_YELLOW</code></li>
</ul>
<p><a href="../images/full_size_images/annotation-boundary-DoubleYellow.PNG"><img alt="" src="../images/annotation-boundary-DoubleYellow.jpg" /></a></p>
<h2 id="traffic-light-annotation">Traffic light annotation</h2>
<ul>
<li>Make SignalLight</li>
<li>Select <code>local</code> instead of <code>global</code> in both Unity and MapToolUtilEdit panel</li>
<li>Find one traffic light that is already made whose type is <code>HDMapSignalLight</code> (with a red boundary box)</li>
<li>Load template by clicking <code>Load SignalLight Template</code> button</li>
</ul>
<p><a href="../images/full_size_images/annotation-load-SignalLight-Template.PNG"><img alt="" src="../images/annotation-load-SignalLight-Template.jpg" /></a></p>
<ul>
<li>In the above screenshot, the left SignalLight (type: HDMapSignalLight) has a red boundary box and the right one (type: MapSignalLight) doesn't have it</li>
<li>Make sure relative axis relations are selected correctly<ul>
<li>In the row of <code>Make SignalLight(HDMapSignalLightBuilder)</code>, select <code>Aim</code> as <code>Y Neg</code>, <code>Up</code> as <code>Z Pos</code></li>
</ul>
</li>
</ul>
<p><a href="../images/annotation-set_axis.jpg"><img alt="" src="../images/annotation-set_axis.jpg" /></a></p>
<ul>
<li>Select your desired empty signal light holder</li>
</ul>
<p><a href="../images/full_size_images/annotation-select-empty-signal-holder.PNG"><img alt="" src="../images/annotation-select-empty-signal-holder.jpg" /></a></p>
<ul>
<li>Click <code>Make SignalLight (HDMapSignalLightBuilder)</code> to generate the signal light</li>
</ul>
<p><a href="../images/full_size_images/annotation-apply-signalLight.PNG"><img alt="" src="../images/annotation-apply-signalLight.jpg" /></a></p>
<ul>
<li>Note: currently, <code>HDMapSignalLightBuilder</code> is for Apollo; one per road is enough. <code>MapSignalLightBuilder</code> is for Autoware, which needs one for every lane. There is a converter button at the bottom of <code>MapToolUtilEdit</code> to get <code>MapSignalLightBuilder</code> from <code>HDMapSignalLightBuilder</code></li>
<li>Link the created traffic light to the corresponding stopline</li>
<li>Select both signallight and the stopline</li>
<li>Click <code>Link SignalLight and StopLine</code> in <code>Advanced Utils</code> section in the panel</li>
</ul>
<p><a href="../images/full_size_images/annotation-link-signallight-stopline.PNG"><img alt="" src="../images/annotation-link-signallight-stopline.jpg" /></a></p>
<ul>
<li>Similarly, you can create stop sign and link the stop sign to the corresponding stopline using corresponding buttons.</li>
</ul>
<h2 id="create-traffic-pole-and-link-to-contained-signal-light-additional-step-for-autoware">Create traffic pole and link to contained signal light (additional step for Autoware)</h2>
<ul>
<li>Select desired traffic pole </li>
<li>Make sure <code>Local</code> and <code>Z Pos</code> are selected</li>
<li>Click <code>Make Traffic Pole (VectorMapPoleBuilder)</code></li>
</ul>
<p><a href="../images/full_size_images/annotation-create-trafficpole.PNG"><img alt="" src="../images/annotation-create-trafficpole.jpg" /></a></p>
<ul>
<li>
<p>Press <code>w</code> so you can rotate the created pole.</p>
</li>
<li>
<p>Rotate the bounding box of the pole to include corresponding signal lights in it</p>
</li>
</ul>
<p><a href="../images/full_size_images/annotation-traffic-pole-after-rotation.PNG"><img alt="" src="../images/annotation-traffic-pole-after-rotation.jpg" /></a></p>
<ul>
<li>Click <code>Link to Contained SignalLights</code> in the traffic pole's inspector</li>
<li>OR select both signal lights and traffic pole, click <code>Link TrafficPole and SignalLight</code> in the MapToolUtilEdit panel</li>
<li>For traffic poles in multiple intersections, to save time you can</li>
<li>Create and rotate for all <code>VectorMapPole</code>s</li>
<li>Select all <code>VectorMapPole</code> in <code>Hierarchy</code> tab -&gt; <code>Link Selected TrafficPoles To Contained SignalLights</code></li>
<li>
<p>Notes for stopline</p>
</li>
<li>
<p>For Autoware, there needs to be two waypoints for every lane, i.e. five waypoints are needed for four lanes, three waypoints are needed for two lanes, etc. Apollo does not have such a requirement. </p>
</li>
</ul>
<h2 id="export-map-files">Export map files</h2>
<ul>
<li>For Apollo, select <code>HDMapTool</code> in <code>Hierachy</code> tab, click <code>Export HD Map</code></li>
</ul>
<p><a href="../images/full_size_images/annotation-exportHDMap.PNG"><img alt="" src="../images/annotation-exportHDMap.jpg" /></a></p>
<ul>
<li>If your map annotation is correct, you will see <code>Successfully generated and exported Apollo HD Map!</code> in the Console</li>
<li>You can find the generated map file in <code>hd_map</code> folder under the root of the repo</li>
<li>It is similar for Autoware: select <code>VectorMapTool</code>, then click <code>Export Vector Map</code></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../npc-map-navigation/" class="btn btn-neutral float-right" title="NPC Map Navigation">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../api-quickstart-descriptions/" class="btn btn-neutral" title="Python API Examples"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2019 LG Electronics Inc.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/lgsvl/simulator/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../api-quickstart-descriptions/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../npc-map-navigation/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
